<!DOCTYPE hml>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Buzzer.click with socket.io and node.js</title>
	<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

	<style>
		#chat {
			height: 500px;
		}
		
		#contentWrap {
			display: none;
		}
		
		#chatWrap {
			float: left;
			border: 1px #000 solid;
		}
	</style>
</head>

<body>
	<div class="container">
		<div id="nickWrap">
			<p>Enter a name:</p>
			<p id="nameError"></p>
			<form id="setName">
				<input size="35" id="name"></input>
				<input type="submit"></input>
			</form>
		</div>

		<div id="contentWrap">
			<div id="chatWrap">
				<div id="chat"></div>
				<form id="send-message">
					<input size="35" id="message"></input>
					<input type="submit"></input>
				</form>
			</div>
			<div id="users"></div>
		</div>
	</div>

	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="js/socket.io.js"></script>
	<script src="bootstrap/js/bootstrap.min.js"></script>

	<script src="js/bundle.js"></script>
	<script>
			$(function(){
					var socket = io() ;
					var $nameForm = $('#setName') ;
					var $nameError = $('#nameError') ;
					var $nameBox = $('#name') ;
					var $messageForm = $('#send-message') ;
					var $messageBox = $('#message') ;
					var $chat = $('#chat') ;
					
					$nameForm.submit(function (e){
							e.preventDefault();
							socket.emit('choose nickname',$nameBox.val(), function(data){
								console.log(data + '\n');
									if(!data){
										$('#nickWrap').hide() ;
										$('#contentWrap').show() ;
									}
									else{
										$nameError.html('That name is already taken') ;
									}
								}
							);
							return false;
						}
					) ;
					$nameBox.val('') ;
					$messageForm.submit(function(e){
							e.preventDefault() ;
							socket.emit('send message', $messageBox.val()) ;
							$messageBox.val('') ;
						}
					);
					socket.on('new message',function(data){
							$chat.append(data+"<br/>") ;
						}) ;
				}) ;
		</script>
</body>

</html>